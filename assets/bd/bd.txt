Create Database website;

USE website;

DROP TABLE IF EXISTS `projeto`;

CREATE TABLE `projeto` (
  `idProjeto` INT NOT NULL AUTO_INCREMENT,
  `anoInicio` INT NOT NULL,
  `nome` VARCHAR(45) NOT NULL,
  `textoSobre` VARCHAR(2500) NOT NULL,
  `linkParaInscricao` VARCHAR(100) DEFAULT NULL,
  `linkSite` VARCHAR(100) DEFAULT NULL,
  `linkBolsista` VARCHAR(100) DEFAULT NULL,
  `linkInstagram` VARCHAR(100) DEFAULT NULL,
  `email` VARCHAR(45) DEFAULT NULL,
  `numero` VARCHAR(45) DEFAULT NULL,
  `capa` VARCHAR(255),
  `banner` VARCHAR(255),
  `tipo` ENUM('ensino', 'pesquisa', 'extensao'),
  `categoria` ENUM('administracao', 'informatica', 'vestuario', 'moda', 'ciencias-naturais', 'ciencias-humanas', 'linguagens', 'matematica'),
  PRIMARY KEY (`idProjeto`)
);

DROP TABLE IF EXISTS `pessoa`;

CREATE TABLE pessoa (
  idPessoa INT NOT NULL AUTO_INCREMENT,
  nome VARCHAR(45) NOT NULL,
  sobrenome VARCHAR(45) NOT NULL,
  email VARCHAR(45) NOT NULL UNIQUE,
  senha VARCHAR(255) NOT NULL,
  tipo ENUM('aluno', 'coordenador', 'bolsista', 'colaborador') DEFAULT 'aluno',
  curso ENUM('administracao', 'informatica', 'vestuario', 'moda', 'gestao-comercial') NULL,
  matricula VARCHAR(20) NULL,
  area ENUM('ciencias-naturais', 'ciencias-humanas', 'linguagens', 'matematica', 'tecnico-administrativo') NULL,
  PRIMARY KEY (idPessoa)
);

DROP TABLE IF EXISTS `pessoa_projeto`;

CREATE TABLE `pessoa_projeto` (
  `idPessoa` INT NOT NULL,
  `idProjeto` INT NOT NULL,
  `tipoPessoa` VARCHAR(45) DEFAULT NULL,
  PRIMARY KEY (`idPessoa`, `idProjeto`),
  FOREIGN KEY (`idProjeto`) REFERENCES `projeto`(`idProjeto`) ON DELETE CASCADE,
  FOREIGN KEY (`idPessoa`) REFERENCES `pessoa`(`idPessoa`) ON DELETE CASCADE
);

ALTER TABLE `pessoa` ADD COLUMN `foto` LONGBLOB DEFAULT NULL;

-- Tabela de monitorias
CREATE TABLE IF NOT EXISTS `monitoria` (
  `idMonitoria` int(11) NOT NULL AUTO_INCREMENT,
  `nome` varchar(255) NOT NULL,
  `tipoMonitoria` varchar(50) NOT NULL,
  `textoSobre` text,
  `email` varchar(255) DEFAULT NULL,
  `diasSemana` varchar(100) DEFAULT NULL,
  `horarioInicio` time DEFAULT NULL,
  `horarioFim` time DEFAULT NULL,
  `capa` varchar(255) DEFAULT NULL,
  `dataCriacao` timestamp NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`idMonitoria`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- Tabela de relacionamento monitoria-pessoa
CREATE TABLE IF NOT EXISTS `monitoria_pessoa` (
  `idMonitoriaPessoa` int(11) NOT NULL AUTO_INCREMENT,
  `idMonitoria` int(11) NOT NULL,
  `idPessoa` int(11) NOT NULL,
  `tipoPessoa` enum('coordenador','monitor') NOT NULL,
  PRIMARY KEY (`idMonitoriaPessoa`),
  KEY `idMonitoria` (`idMonitoria`),
  KEY `idPessoa` (`idPessoa`),
  CONSTRAINT `fk_monitoria_pessoa_monitoria` FOREIGN KEY (`idMonitoria`) REFERENCES `monitoria` (`idMonitoria`) ON DELETE CASCADE,
  CONSTRAINT `fk_monitoria_pessoa_pessoa` FOREIGN KEY (`idPessoa`) REFERENCES `pessoa` (`idPessoa`) ON DELETE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;